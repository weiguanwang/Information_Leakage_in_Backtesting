# README	
- [README](#readme)
  - [Contact and citation](#contact-and-citation)
  - [Introduction](#introduction)
  - [Code structure](#code-structure)
  - [Data folder structure](#data-folder-structure)
  - [Package information](#package-information)


## Contact and citation

*Authors and affiliations:*

   Weiguan Wang [weiguanwang@outlook.com](), https://weiguanwang.github.io/

   Prof. Johannes Ruf [j.ruf@lse.ac.uk](), http://www.maths.lse.ac.uk/Personal/jruf/

   Department of Mathematics, London School of Economics and Political Science, London, United Kingdom

   30 January 2021


*Suggested citation:*
   
    J. Ruf and W. Wang (2021), Information leakage in backtesting.

*Supplementary reading:*

    J. Ruf and W. Wang (2020b), Hedging with linear regressions and neural networks, SSRN 3580132, 2020. Accepted by the Journal of Business and Economic Statistics subject to minor corrections. Download at https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3580132

    J. Ruf and W. Wang (2020a), Neural networks for option pricing and hedging: A literature review, Journal of Computational Finance, volume 24, number 1, pages 1-45. Download at  https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3486363

## Introduction

This documentation explains the code structure and data folders to reproduce the results in Ruf and Wang (2020b). To run the code provided here, the user needs to:

1. Overwrite the `DATA_DIR` variable in the `setup.py` to your own choice.
2. Obtain raw data (should you want to work with historical datasets) and rename files as detailed in [Data folder structure](#Data-folder-structure).

## Code structure

The code consists of three subfolders. They are `libaray`, `Simulation`, and `OptionMetrics`. The `library` folder contains functions used by other parts of the code. The `library` consists of:

1. `bs.py` : This file contains a function used to simulate the Black-Scholes dataset.
2. `cleaner_aux.py`: This file contains functions used to clean raw data.
3. `common.py` : This file contains functions that calculate and inspect the hedging error.
4. `loader_aux.py` : This file contains functions used to load clean data (before training the ANN or linear regressions).
5. `network.py` : This file implements HedgeNet and auxiliary functions.
6. `plot.py`: This file contains functions used to plot diagnostic figures. 
7. `regression_aux.py`: This file contains functions that implement the linear regression methods.
8. `simulation.py`: This file contains functions that implement the CBOE rules, and organize data.
9.  `vix.py`: This file contains the function that simulates an Ornstein-Uhlenbeck  process, used as the fake VIX feature.



In each of the other two folder, there are two python files that are used by other notebooks:

1. `setup.py`: This file contains all the flags to configure experiments. It varies by datasets, and contains two major configurations:
   1. It specifies the hedging period, time window size, data cleaning choice, and other experimental setup.
   2. It specifies the location of raw data, clean data, and the stored results.
2.  `Load_Clean_aux.py` loads the clean data and implements some extra cleaning, before running linear regressions or ANNs.

The notebooks have a very similar structure as follows:

1. In the simulation folder, the first notebook implements the data simulation. In the OptionMetrics folder, the first notebook implements the cleaning of the historical raw dataset downloaded from data providers. 
2. `2_Regression_Generate.ipynb` implements all linear regressions on sensitivities and stores the PNL (MSHE) files.
3. `3_Tuning _Hyper.ipynb` implements the tuning of $L^2 $ regularisation parameters. 
4. `4_Network.ipynb` implements the training of the ANN and stores the PNL files (MSHE of ANN).
5. `5_Permute_VIX_Analysis.ipynb` implements the analysis of permutation and fake VIX experiments. The implementation of the experiment is done in notebook 2 and 4, by giving the corresponding setup flags. 

## Data folder structure

Before running the code, one needs to specify the directory that stores the simulation data, (or historical data) and the results. This is done by overwriting the `DATA_DIR` variable in each of the `setup.py` file. 

The data folders  have two common subfolders,

1. `CleanData`: It stores the simulated data in case of Black-Scholes data, or cleaned data generated by `1_Clean.ipynb` in case of historical data.
2. `Result`: It store the PNL files and other auxiliary files, either from the linear regressions or ANN. They also include  tables made by `5_Diagnostic.ipynb`. For the ANN, it additionally contains loss plots, checkpoints, etc. For the linear regression, it additionally contains regression coefficients, standard errors, etc.

For the historical dataset, there is an extra folder `RawData` to store data given by data providers. Data needs to be arranged and renamed in the following way for the code to run.

- For the S\&P 500 data. There are 4 files:

  1. `option_price.csv` contains option quotes downloaded from OptionMetrics. 

  2. `spx500.csv` contains the close-of-day price of S\&P 500. 

  3. `onr.csv` contains the overnight LIBOR rate downloaded from Bloomberg.

  4. `interest_rate.csv` contains the interest rate derived from zero-coupon bond for maturity larger than 7 days, downloaded from OptionMetrics.


## Package information

| Package      | Version |
| ------------ | ------- |
| Anaconda     | 2019.03 |
| Keras        | 2.2.4   |
| Python       | 3.6     |
| Numpy        | 1.16.3  |
| Pandas       | 0.24.2  |
| Scikit-learn | 0.20.3  |
| Scipy        | 1.2.1   |
| Seaborn      | 0.9     |
| Tensorflow   | 1.13.1  |

